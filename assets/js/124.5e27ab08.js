(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{525:function(t,s,e){"use strict";e.r(s);var a=e(27),r=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("有这么一张表 t_user，id是主键、phone是也是主键，name、class是联合主键")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("ID")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("NAME")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("PHONE")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("CLASS")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("1")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("张一")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("18688887777")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("一班")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("2")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("张二")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("18688887778")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("二班")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("3")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("张三")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("18688887779")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("三班")])])])]),t._v(" "),e("h3",{attrs:{id:"回表、索引覆盖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#回表、索引覆盖"}},[t._v("#")]),t._v(" 回表、索引覆盖")]),t._v(" "),e("p",[e("strong",[t._v("拿索引当条件查才行")])]),t._v(" "),e("p",[t._v("在索引上查询，查到到之后不能直接返回行数据，需要去数据文件或另一个索引继续查才能获得select的数据，就叫回表")]),t._v(" "),e("p",[t._v("反之一次查询就返回select的内容了（例如select的内容在聚集索引或者同一个索引上查询），就叫索引覆盖")]),t._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" t_name "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" id "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("如果是MyISAM的非聚集式索引，通过主键id查询到的结果是行地址，需要再去数据文件拿到全部的行数据，这就代表回表了")]),t._v(" "),e("p",[t._v("如果是InnoDB的聚集式索引，通过主键id查询到的结果直接带上整行数据了，不需要额外再查别的了，就说明索引覆盖了")]),t._v(" "),e("p",[t._v("如果在InnoDB上这么查询呢？")]),t._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" t_name "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" phone "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("18688887777")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("因为聚集索引只有一个，phone这个索引就叫二级索引（也叫辅助索引），它就只能是非聚集索引了")]),t._v(" "),e("p",[t._v("mysql执行的过程就是通过phone查到了id，然后拿着id回表，再通过id返回整行数据")]),t._v(" "),e("h3",{attrs:{id:"索引下推"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#索引下推"}},[t._v("#")]),t._v(" 索引下推")]),t._v(" "),e("p",[t._v("索引下推是Mysql自动帮你做的一件事，原则上就是查询条件上有索引的条件，先按照索引查出来交集，再回表查，可以减少回表次数")]),t._v(" "),e("p",[t._v("也是Mysql5.6之后才有的")]),t._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" t_name "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" name "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("like")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'张%'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" class "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("like")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'一%'")]),t._v("\n")])])]),e("p",[t._v("如果不开启索引下推，那么需要让name字段like一下姓张的，回表把结果集都拿出来，再让class字段like一个‘一’开头的")]),t._v(" "),e("p",[t._v("开启的话，直接根据姓张的条件，返回name,class两个字段，先不回表，然后再把class字段like一下出个交集，再回表")]),t._v(" "),e("p",[t._v("想关闭的话")]),t._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" optimizer_switch"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index_condition_pushdown=off'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);